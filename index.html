<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI-Agentur Zielgruppen-Dashboard | Everlast AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-card: rgba(18, 18, 18, 0.9);
            --bg-card-solid: #0a0a0a;
            --bg-card-border: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #52525b;
            --accent-yellow: #faef70;
            --accent-yellow-dim: rgba(250, 239, 112, 0.7);
            --accent-yellow-glow: rgba(250, 239, 112, 0.25);
            --green: #4ade80;
            --green-glow: rgba(74, 222, 128, 0.25);
            --yellow: #faef70;
            --red: #f87171;
            --red-glow: rgba(248, 113, 113, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Subtle Glow Effects */
        .glow-left {
            position: fixed;
            left: -20%;
            top: 20%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, var(--accent-yellow-glow) 0%, transparent 60%);
            filter: blur(120px);
            pointer-events: none;
            z-index: 0;
            opacity: 0.6;
        }

        .glow-bottom {
            position: fixed;
            bottom: -25%;
            right: 5%;
            width: 700px;
            height: 500px;
            background: radial-gradient(ellipse, var(--accent-yellow-glow) 0%, transparent 60%);
            filter: blur(150px);
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        /* Header */
        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2.5rem;
            border-bottom: 1px solid var(--bg-card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            height: 40px;
            width: auto;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            font-weight: 400;
            font-style: normal;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-refresh {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-refresh:hover {
            border-color: var(--accent-yellow);
            color: var(--accent-yellow);
        }

        /* Pill Badge */
        .pill-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: 1px solid rgba(250, 239, 112, 0.4);
            border-radius: 9999px;
            background: rgba(250, 239, 112, 0.08);
            color: var(--accent-yellow);
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .pill-badge::before {
            content: "";
            width: 6px;
            height: 6px;
            background: var(--accent-yellow);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            padding: 1.5rem 2.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--bg-card-border);
            padding: 1.25rem 1.5rem;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(250, 239, 112, 0.3);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 400;
            font-style: italic;
            color: var(--text-primary);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 500;
        }

        .stat-green .stat-value { color: var(--green); }
        .stat-yellow .stat-value { color: var(--accent-yellow); }
        .stat-red .stat-value { color: var(--red); }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 2.5rem 2.5rem;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
            align-items: start;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: sticky;
            top: 100px;
            align-self: flex-start;
        }

        .filter-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--bg-card-border);
        }

        .filter-title {
            font-family: 'Playfair Display', serif;
            font-size: 0.85rem;
            font-weight: 400;
            font-style: italic;
            color: var(--accent-yellow);
            margin-bottom: 0.875rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-title::before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-yellow);
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--bg-card-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(250, 239, 112, 0.4);
            background: rgba(255, 255, 255, 0.05);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .filter-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0.6rem 0.875rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.15s;
            margin-bottom: 2px;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.04);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-yellow);
            color: var(--bg-primary);
            font-weight: 600;
        }

        .filter-btn .count {
            background: rgba(255, 255, 255, 0.08);
            padding: 0.15rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .filter-btn.active .count {
            background: rgba(0, 0, 0, 0.15);
        }

        /* Use Case Legend */
        .use-case-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .legend-item {
            font-size: 0.65rem;
            padding: 0.35rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.15s;
            border: 1px solid transparent;
        }

        .legend-item:hover, .legend-item.active {
            opacity: 1;
            border-color: currentColor;
        }

        /* Content Area */
        .content-area {
            min-width: 0;
        }

        .table-container {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--bg-card-border);
            overflow: hidden;
        }

        .table-scroll {
            max-height: calc(100vh - 280px);
            min-height: 600px;
            overflow-y: auto;
        }

        .table-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .table-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(250, 239, 112, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        colgroup col:nth-child(1) { width: 110px; }  /* Bewertung */
        colgroup col:nth-child(2) { width: auto; }   /* Sektor */
        colgroup col:nth-child(3) { width: auto; }   /* Zielgruppe */
        colgroup col:nth-child(4) { width: auto; }   /* Use Cases */
        colgroup col:nth-child(5) { width: 90px; }   /* Validiert */

        th {
            background: rgba(15, 15, 15, 0.98);
            padding: 1rem 1.25rem;
            text-align: left;
            font-family: 'Playfair Display', serif;
            font-weight: 400;
            font-style: italic;
            font-size: 0.75rem;
            color: var(--accent-yellow-dim);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid var(--bg-card-border);
        }

        td {
            padding: 0.875rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            font-size: 0.85rem;
            vertical-align: middle;
        }

        tr {
            transition: background 0.15s;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            min-width: 70px;
        }

        .badge-green {
            background: rgba(74, 222, 128, 0.12);
            color: var(--green);
            border: 1px solid rgba(74, 222, 128, 0.25);
        }

        .badge-yellow {
            background: rgba(250, 239, 112, 0.1);
            color: var(--accent-yellow);
            border: 1px solid rgba(250, 239, 112, 0.2);
        }

        .badge-red {
            background: rgba(248, 113, 113, 0.1);
            color: var(--red);
            border: 1px solid rgba(248, 113, 113, 0.2);
        }

        .sektor-cell {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sektor-badge {
            background: rgba(250, 239, 112, 0.12);
            color: var(--accent-yellow);
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.65rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            flex-shrink: 0;
        }

        .sektor-name {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .zielgruppe-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Use Case Tags */
        .use-cases-cell {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }

        .use-case-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 500;
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .uc-voice-inbound,
        .uc-voice-outbound,
        .uc-chatbot,
        .uc-angebot,
        .uc-support,
        .uc-wissen,
        .uc-workflows {
            background: rgba(255, 255, 255, 0.04);
            color: var(--text-secondary);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .validated-badge {
            background: rgba(74, 222, 128, 0.15);
            color: var(--green);
            border: 1px solid rgba(74, 222, 128, 0.3);
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .empty-cell {
            color: var(--text-muted);
            font-size: 0.75rem;
            opacity: 0.5;
        }

        /* Expandable Rows */
        tr[data-code] {
            cursor: pointer;
        }

        tr[data-code]:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        tr[data-code]:hover .zielgruppe-name {
            color: var(--accent-yellow);
        }

        .expand-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            margin-right: 0.75rem;
            color: var(--text-muted);
            transition: all 0.2s ease;
            opacity: 0.5;
        }

        .expand-icon svg {
            width: 12px;
            height: 12px;
        }

        tr[data-code]:hover .expand-icon {
            opacity: 1;
            color: var(--accent-yellow);
        }

        tr.expanded .expand-icon {
            transform: rotate(180deg);
            color: var(--accent-yellow);
            opacity: 1;
        }

        tr.expanded {
            background: rgba(250, 239, 112, 0.04);
            border-left: 2px solid var(--accent-yellow);
        }

        tr.expanded td:first-child {
            padding-left: calc(1.25rem - 2px);
        }

        /* Keywords Row */
        .keywords-row {
            display: none;
        }

        .keywords-row.active {
            display: table-row;
        }

        .keywords-row td {
            padding: 0;
            background: rgba(20, 20, 20, 0.5);
            border-bottom: 1px solid var(--bg-card-border);
            border-left: 2px solid var(--accent-yellow);
        }

        .keywords-content {
            padding: 1rem 1.5rem 1.25rem 4rem;
            animation: slideDown 0.15s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .keywords-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .keywords-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .keyword-tag {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            padding: 0.4rem 0.85rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.15s;
        }

        .keyword-tag:hover {
            background: rgba(250, 239, 112, 0.1);
            border-color: rgba(250, 239, 112, 0.4);
            color: var(--accent-yellow);
        }

        .keyword-tag.copied {
            background: rgba(74, 222, 128, 0.15);
            border-color: rgba(74, 222, 128, 0.4);
            color: var(--green);
        }

        .no-keywords {
            color: var(--text-muted);
            font-size: 0.8rem;
            font-style: italic;
        }

        /* Details Grid */
        .details-grid {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .details-section {
            flex: 1;
        }

        .details-section.details-meta {
            flex: 0 0 auto;
            display: grid;
            grid-template-columns: repeat(2, auto);
            gap: 0.5rem 1.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .meta-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .meta-value {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .details-notes {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .details-notes .meta-label {
            font-style: normal;
            margin-right: 0.25rem;
        }

        /* Disclaimer Footer */
        .disclaimer {
            margin-top: 3rem;
            padding: 1.5rem 2.5rem;
            background: rgba(248, 113, 113, 0.03);
            border-top: 1px solid rgba(248, 113, 113, 0.15);
        }

        .disclaimer-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .disclaimer-icon {
            font-size: 1rem;
            opacity: 0.6;
        }

        .disclaimer-text {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .disclaimer p {
            font-size: 0.7rem;
            color: var(--text-muted);
            line-height: 1.6;
            margin: 0;
        }

        .disclaimer strong {
            color: var(--text-secondary);
        }

        .disclaimer .nace-info {
            opacity: 0.7;
            font-size: 0.65rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .filter-section {
                flex: 1;
                min-width: 200px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
                padding: 1rem;
            }
            .main-content {
                padding: 0 1rem 1rem;
            }
            h1 {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Glow Effects -->
    <div class="glow-left"></div>
    <div class="glow-bottom"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="assets/Logo_EVERLAST__weiss-3f8b994c-3aec-4b27-a615-8ef378ab8aa8.png" alt="Everlast AI" class="logo-icon">
            </div>
            <h1>KI-Agentur Zielgruppen-Dashboard</h1>
            <div class="header-actions">
                <button class="btn-refresh" onclick="init()">Aktualisieren</button>
                <span class="pill-badge">LIVE SYNC</span>
            </div>
        </div>
    </header>

    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-value" id="totalCount">0</div>
            <div class="stat-label">Zielgruppen</div>
        </div>
        <div class="stat-card stat-green">
            <div class="stat-value" id="greenCount">0</div>
            <div class="stat-label">Top-Zielgruppen</div>
        </div>
        <div class="stat-card stat-yellow">
            <div class="stat-value" id="yellowCount">0</div>
            <div class="stat-label">Potenzial</div>
        </div>
        <div class="stat-card stat-red">
            <div class="stat-value" id="redCount">0</div>
            <div class="stat-label">Niedrig</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="validatedCount">0</div>
            <div class="stat-label">Validiert</div>
        </div>
    </div>

    <div class="main-content">
        <aside class="sidebar">
            <div class="filter-section">
                <div class="filter-title">Suche</div>
                <input type="text" class="search-input" id="searchInput" placeholder="Zielgruppe suchen...">
            </div>

            <div class="filter-section">
                <div class="filter-title">Bewertung</div>
                <button class="filter-btn active" data-filter="all" data-type="rating">Alle <span class="count" id="allRatingCount">0</span></button>
                <button class="filter-btn" data-filter="green" data-type="rating">Top (Gr√ºn) <span class="count" id="greenFilterCount">0</span></button>
                <button class="filter-btn" data-filter="yellow" data-type="rating">Potenzial (Gelb) <span class="count" id="yellowFilterCount">0</span></button>
                <button class="filter-btn" data-filter="red" data-type="rating">Niedrig (Rot) <span class="count" id="redFilterCount">0</span></button>
            </div>

            <div class="filter-section">
                <div class="filter-title">Sektor</div>
                <div id="sektorFilters" style="max-height: 200px; overflow-y: auto;"></div>
            </div>

            <div class="filter-section">
                <div class="filter-title">Use Cases</div>
                <div class="use-case-legend" id="useCaseFilters">
                    <span class="legend-item use-case-tag uc-voice-inbound" data-uc="voice-inbound">Voice Inbound</span>
                    <span class="legend-item use-case-tag uc-voice-outbound" data-uc="voice-outbound">Voice Outbound</span>
                    <span class="legend-item use-case-tag uc-chatbot" data-uc="chatbot">Chatbot</span>
                    <span class="legend-item use-case-tag uc-angebot" data-uc="angebot">Angebots-Autom.</span>
                    <span class="legend-item use-case-tag uc-support" data-uc="support">Support/Service</span>
                    <span class="legend-item use-case-tag uc-wissen" data-uc="wissen">KI-Wissensmanagement</span>
                    <span class="legend-item use-case-tag uc-workflows" data-uc="workflows">Indiv. Workflows</span>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title">Status</div>
                <button class="filter-btn" data-filter="validated" data-type="validated">Nur Validierte <span class="count" id="valFilterCount">0</span></button>
            </div>
        </aside>

        <main class="content-area">
            <div class="table-container">
                <div class="table-scroll">
                    <table>
                        <colgroup>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                            <tr>
                                <th>Bewertung</th>
                                <th>Sektor</th>
                                <th>Zielgruppe</th>
                                <th>Use Cases</th>
                                <th>Validiert</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <footer class="disclaimer">
        <div class="disclaimer-content">
            <span class="disclaimer-icon">‚ö†</span>
            <div class="disclaimer-text">
                <p><strong>Vertrauliche Ressource</strong> ‚Äî Dieses Dokument ist ausschlie√ülich f√ºr autorisierte Kunden der Everlast Consulting GmbH bestimmt. Die Vervielf√§ltigung, Weitergabe oder Ver√∂ffentlichung ‚Äì auch auszugsweise ‚Äì an unbefugte Dritte ist ohne ausdr√ºckliche schriftliche Genehmigung strikt untersagt. Zuwiderhandlungen werden zivil- und strafrechtlich verfolgt.</p>
                <p class="nace-info">Die Branchenklassifikation basiert auf dem <strong>NACE-Code</strong> (Nomenclature statistique des Activit√©s √©conomiques dans la Communaut√© Europ√©enne) ‚Äì dem europ√§ischen Standard zur Klassifizierung von Wirtschaftszweigen.</p>
            </div>
        </div>
    </footer>

    <script>
        // ===== KONFIGURATION =====
        const SHEET_ID = '1a9_4DEy9K8vaehLUujwHDnvFDCM5d1Dakm9c40bTKPg';

        // Standardisierte Use Cases
        const USE_CASES = {
            'voice-inbound': 'Voice Inbound',
            'voice-outbound': 'Voice Outbound',
            'chatbot': 'Chatbot',
            'angebot': 'Angebots-Autom.',
            'support': 'Support/Service',
            'wissen': 'KI-Wissensmanagement',
            'workflows': 'Indiv. Workflows'
        };

        // ===== LIVE DATA LOADING (JSONP - umgeht CORS) =====
        let data = [];
        let keywordsData = {}; // NACE-Code -> [keywords]
        const KEYWORDS_GID = '1767725536';

        function loadDataFromSheet() {
            return new Promise((resolve) => {
                // Callback-Funktion f√ºr JSONP
                const callbackName = 'googleSheetCallback_' + Date.now();

                window[callbackName] = function(response) {
                    // Aufr√§umen
                    delete window[callbackName];
                    document.getElementById('jsonp-script')?.remove();

                    if (response.status === 'error') {
                        console.error('Sheet Fehler:', response.errors);
                        resolve(null);
                        return;
                    }

                    // Daten aus Google Visualization Response extrahieren
                    const rows = response.table.rows;
                    const cols = response.table.cols;

                    console.log('Live-Daten empfangen:', rows.length, 'Zeilen');

                    const parsedData = rows.map(row => {
                        const getValue = (idx) => row.c[idx]?.v || '';

                        // Use Cases aus den einzelnen Checkbox-Spalten
                        // H(7): Voice Inbound, I(8): Voice Outbound, J(9): KI-Wissensmanagement
                        // K(10): Indiv. Workflows, L(11): Chatbot, M(12): Angebot, N(13): Support
                        const useCases = [];
                        if (hasValue(getValue(7))) useCases.push('voice-inbound');
                        if (hasValue(getValue(8))) useCases.push('voice-outbound');
                        if (hasValue(getValue(9))) useCases.push('wissen');
                        if (hasValue(getValue(10))) useCases.push('workflows');
                        if (hasValue(getValue(11))) useCases.push('chatbot');
                        if (hasValue(getValue(12))) useCases.push('angebot');
                        if (hasValue(getValue(13))) useCases.push('support');

                        const zielgruppe = getValue(5);
                        return {
                            code: getValue(4) || getValue(0),
                            sektor: getValue(1),
                            sektorName: getValue(2),
                            zielgruppe: zielgruppe,
                            bewertung: normalizeBewertung(getValue(6), zielgruppe),
                            useCases: useCases,
                            telefonvolumen: getValue(14),
                            technischeReife: getValue(15),
                            regulatorisch: getValue(16),
                            marktgroesse: getValue(17),
                            validiert: hasValue(getValue(18)),
                            notizen: getValue(19)
                        };
                    }).filter(item => item.zielgruppe);

                    resolve(parsedData);
                };

                // JSONP Script einf√ºgen
                const script = document.createElement('script');
                script.id = 'jsonp-script';
                script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=responseHandler:${callbackName}`;
                script.onerror = () => {
                    console.error('JSONP Ladefehler');
                    resolve(null);
                };
                document.body.appendChild(script);
            });
        }

        function loadKeywordsFromSheet() {
            return new Promise((resolve) => {
                const callbackName = 'keywordsCallback_' + Date.now();

                window[callbackName] = function(response) {
                    delete window[callbackName];
                    document.getElementById('keywords-script')?.remove();

                    if (response.status === 'error') {
                        console.error('Keywords Sheet Fehler:', response.errors);
                        resolve({});
                        return;
                    }

                    const rows = response.table.rows;
                    const keywords = {};

                    rows.forEach(row => {
                        const getValue = (idx) => row.c[idx]?.v || '';
                        const zielgruppe = getValue(1); // Spalte B = Zielgruppe
                        if (zielgruppe) {
                            keywords[zielgruppe] = [
                                getValue(2), getValue(3), getValue(4),
                                getValue(5), getValue(6), getValue(7)
                            ].filter(k => k);
                        }
                    });

                    console.log('Keywords geladen:', Object.keys(keywords).length, 'Eintr√§ge');
                    resolve(keywords);
                };

                const script = document.createElement('script');
                script.id = 'keywords-script';
                script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${KEYWORDS_GID}&tqx=responseHandler:${callbackName}`;
                script.onerror = () => {
                    console.error('Keywords JSONP Ladefehler');
                    resolve({});
                };
                document.body.appendChild(script);
            });
        }

        // ===== ACCORDION FUNCTIONS =====
        function toggleRow(code) {
            const mainRow = document.querySelector(`tr[data-code="${code}"]`);
            const keywordsRow = document.querySelector(`tr[data-keywords-for="${code}"]`);

            if (!mainRow || !keywordsRow) return;

            const isExpanded = mainRow.classList.contains('expanded');

            // Close all other expanded rows
            document.querySelectorAll('tr.expanded').forEach(row => {
                row.classList.remove('expanded');
            });
            document.querySelectorAll('tr.keywords-row.active').forEach(row => {
                row.classList.remove('active');
            });

            // Toggle current row
            if (!isExpanded) {
                mainRow.classList.add('expanded');
                keywordsRow.classList.add('active');
            }
        }

        function copyKeyword(element, keyword, event) {
            event.stopPropagation();
            navigator.clipboard.writeText(keyword).then(() => {
                element.classList.add('copied');
                setTimeout(() => element.classList.remove('copied'), 1500);
            });
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            if (lines.length < 2) return [];

            // Spalten im Sheet:
            // A(0): NACE-Code, B(1): Sektor, C(2): Sektor-Name, D(3): Abteilung, E(4): Gruppe
            // F(5): Zielgruppe/Nische, G(6): Bewertung
            // H(7): Voice Inbound, I(8): Voice Outbound, J(9): Terminierung, K(10): Lead-Qualifizierung
            // L(11): Chatbot/KB, M(12): Angebots-Automatisierung, N(13): Support/Service
            // O(14): Telefonvolumen, P(15): Technische Reife, Q(16): Regulatorische H√ºrden
            // R(17): Marktgr√∂√üe DE, S(18): Validiert, T(19): Notizen

            return lines.slice(1).map(line => {
                const values = parseCSVLine(line);

                // Use Cases aus den einzelnen Checkbox-Spalten zusammenbauen
                // H(7): Voice Inbound, I(8): Voice Outbound, J(9): KI-Wissensmanagement
                // K(10): Indiv. Workflows, L(11): Chatbot, M(12): Angebot, N(13): Support
                const useCases = [];
                if (hasValue(values[7])) useCases.push('voice-inbound');
                if (hasValue(values[8])) useCases.push('voice-outbound');
                if (hasValue(values[9])) useCases.push('wissen');
                if (hasValue(values[10])) useCases.push('workflows');
                if (hasValue(values[11])) useCases.push('chatbot');
                if (hasValue(values[12])) useCases.push('angebot');
                if (hasValue(values[13])) useCases.push('support');

                const zielgruppe = values[5] || '';
                return {
                    code: values[4] || values[0] || '',  // Gruppe oder NACE-Code
                    sektor: values[1] || '',
                    sektorName: values[2] || '',
                    zielgruppe: zielgruppe,
                    bewertung: normalizeBewertung(values[6], zielgruppe),
                    useCases: useCases,
                    validiert: hasValue(values[18])
                };
            }).filter(item => item.zielgruppe);
        }

        function hasValue(val) {
            if (!val) return false;
            const v = val.toLowerCase().trim();
            return v === 'x' || v === 'ja' || v === 'yes' || v === 'true' || v === '1';
        }

        function normalizeBewertung(value, zielgruppe) {
            if (!value) return 'rot';
            const v = value.trim();
            const vLower = v.toLowerCase();

            // Debug: Zeige Glaswaren-Bewertung
            if (zielgruppe && zielgruppe.includes('Glas')) {
                console.log('GLASWAREN DEBUG:', {
                    raw: value,
                    trimmed: v,
                    charCodes: [...v].map(c => c.charCodeAt(0)),
                    length: v.length
                });
            }

            // Emoji-Erkennung (verschiedene Unicode-Varianten)
            if (v.includes('üü¢') || v.includes('gr√ºn') || vLower.includes('gr√ºn') || vLower.includes('gruen') || vLower.includes('green') || vLower === 'g') return 'gruen';
            if (v.includes('üü°') || vLower.includes('gelb') || vLower.includes('yellow') || vLower === 'y') return 'gelb';
            if (v.includes('üî¥') || vLower.includes('rot') || vLower.includes('red') || vLower === 'r') return 'rot';

            // Fallback: Pr√ºfe auf Farbw√∂rter irgendwo im String
            if (vLower.includes('gr√ºn') || vLower.includes('green') || vLower.includes('top')) return 'gruen';
            if (vLower.includes('gelb') || vLower.includes('yellow') || vLower.includes('mittel') || vLower.includes('potenzial')) return 'gelb';
            if (vLower.includes('rot') || vLower.includes('red') || vLower.includes('niedrig')) return 'rot';

            return 'rot';
        }

        function parseUseCases(value) {
            if (!value || value.trim() === '') return [];
            return value.split(/[;,]/).map(uc => uc.trim().toLowerCase().replace(/\s+/g, '-')).filter(uc => uc);
        }

        async function init() {
            showLoadingState();

            // Parallel laden: Zielgruppen und Keywords
            const [liveData, keywords] = await Promise.all([
                loadDataFromSheet(),
                loadKeywordsFromSheet()
            ]);

            if (liveData && liveData.length > 0) {
                data = liveData;
                console.log(`Live-Daten geladen: ${data.length} Eintr√§ge`);
            } else {
                data = FALLBACK_DATA;
                console.log('Fallback-Daten verwendet');
            }

            keywordsData = keywords;

            renderSektorFilters();
            renderTable();
            hideLoadingState();
        }

        function showLoadingState() {
            document.getElementById('tableBody').innerHTML = '<tr><td colspan="5" style="text-align:center;padding:2rem;color:var(--accent-yellow);">Lade Daten...</td></tr>';
        }

        function hideLoadingState() {}

        // ===== FALLBACK DATEN =====
        const FALLBACK_DATA = [
            // A - Land- und Forstwirtschaft
            {code:"01.01",sektor:"A",sektorName:"Land-/Forstwirtschaft",zielgruppe:"Anbau einj√§hriger Pflanzen",bewertung:"rot",useCases:[],validiert:false},
            {code:"01.04",sektor:"A",sektorName:"Land-/Forstwirtschaft",zielgruppe:"Tierhaltung",bewertung:"rot",useCases:[],validiert:false},
            {code:"01.06",sektor:"A",sektorName:"Land-/Forstwirtschaft",zielgruppe:"Landwirtschaftliche Dienstleistungen",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"02.01",sektor:"A",sektorName:"Land-/Forstwirtschaft",zielgruppe:"Forstwirtschaft",bewertung:"rot",useCases:[],validiert:false},
            {code:"03.01",sektor:"A",sektorName:"Land-/Forstwirtschaft",zielgruppe:"Fischerei und Aquakultur",bewertung:"rot",useCases:[],validiert:false},
            // B - Bergbau
            {code:"5",sektor:"B",sektorName:"Bergbau",zielgruppe:"Kohlenbergbau",bewertung:"rot",useCases:[],validiert:false},
            {code:"8",sektor:"B",sektorName:"Bergbau",zielgruppe:"Gewinnung Steine/Erden",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            // C - Verarbeitendes Gewerbe
            {code:"10.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Fleischverarbeitung",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"10.7",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Backwaren",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"11.0",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Getr√§nkeherstellung",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"13.9",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Sonstige Textilien",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"16.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"S√§ge-/Hobelwerke",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"18.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Druckereien",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"20.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Chemische Grundstoffe",bewertung:"gelb",useCases:["support"],validiert:false},
            {code:"21.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Pharmazeutische Erzeugnisse",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"22.2",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Kunststoffwaren",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"23.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Glas und Glaswaren",bewertung:"gruen",useCases:["voice-inbound","angebot"],validiert:true},
            {code:"24.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Eisen/Stahl",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"25.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Stahl-/Leichtmetallbau",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"28.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Maschinenbau allgemein",bewertung:"gruen",useCases:["chatbot","angebot","support"],validiert:true},
            {code:"29.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Kraftwagen und -motoren",bewertung:"gelb",useCases:["support"],validiert:false},
            {code:"31.0",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"M√∂belherstellung",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"33.1",sektor:"C",sektorName:"Verarbeitendes Gewerbe",zielgruppe:"Reparatur Metallerzeugnisse",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            // D - Energieversorgung
            {code:"35.1",sektor:"D",sektorName:"Energieversorgung",zielgruppe:"Elektrizit√§tsversorgung",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"35.11",sektor:"D",sektorName:"Energieversorgung",zielgruppe:"Photovoltaik/Solar",bewertung:"gruen",useCases:["voice-outbound","support"],validiert:true},
            {code:"35.12",sektor:"D",sektorName:"Energieversorgung",zielgruppe:"W√§rmepumpen",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            // E - Wasserversorgung/Entsorgung
            {code:"36.0",sektor:"E",sektorName:"Wasserversorgung",zielgruppe:"Wasserversorgung",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"38.1",sektor:"E",sektorName:"Wasserversorgung",zielgruppe:"Abfallsammlung",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            // F - Baugewerbe
            {code:"41.2",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Bau von Geb√§uden",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"42.1",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Stra√üen-/Bahnbau",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.11",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Abbrucharbeiten",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.21",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Elektroinstallation",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"43.21.3",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Smart Home / Geb√§udeautomation",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"43.21.4",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"E-Mobilit√§t / Wallbox",bewertung:"gruen",useCases:[],validiert:false},
            {code:"43.22",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"SHK (Sanit√§r/Heizung/Klima)",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"43.22.1",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Heizungsbau",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"43.22.2",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Sanit√§rinstallation",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"43.22.3",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Klimatechnik/L√ºftung",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"43.31",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Stuckateur/Verputzer",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.32",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Bautischlerei/-schlosserei",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.33",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Fu√üboden/Fliesen/Tapeten",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.34",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Maler/Glaser",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"43.91",sektor:"F",sektorName:"Baugewerbe",zielgruppe:"Dachdecker/Zimmerei",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            // G - Handel
            {code:"45.11",sektor:"G",sektorName:"Handel",zielgruppe:"KFZ-Handel (Autoh√§user)",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"45.20",sektor:"G",sektorName:"Handel",zielgruppe:"KFZ-Werkst√§tten",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"45.20.3",sektor:"G",sektorName:"Handel",zielgruppe:"Karosserie-/Lackierbetrieb",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"45.20.4",sektor:"G",sektorName:"Handel",zielgruppe:"Reifenservice",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"46.1",sektor:"G",sektorName:"Handel",zielgruppe:"Handelsvermittlung",bewertung:"gelb",useCases:["voice-outbound"],validiert:false},
            {code:"46.2",sektor:"G",sektorName:"Handel",zielgruppe:"Gro√ühandel landw. Grundstoffe",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"46.4",sektor:"G",sektorName:"Handel",zielgruppe:"Gro√ühandel Gebrauchsg√ºter",bewertung:"gruen",useCases:["voice-outbound","support"],validiert:true},
            {code:"46.6",sektor:"G",sektorName:"Handel",zielgruppe:"Gro√ühandel Maschinen",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"46.7",sektor:"G",sektorName:"Handel",zielgruppe:"Sonstiger Gro√ühandel",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"46.73",sektor:"G",sektorName:"Handel",zielgruppe:"Gro√ühandel Holz/Baustoffe",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"46.74",sektor:"G",sektorName:"Handel",zielgruppe:"Gro√ühandel Sanit√§r/Heizung",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"47.1",sektor:"G",sektorName:"Handel",zielgruppe:"Einzelhandel (Ladengesch√§ft)",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"47.74",sektor:"G",sektorName:"Handel",zielgruppe:"Apotheken",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"47.78",sektor:"G",sektorName:"Handel",zielgruppe:"Sanit√§tsh√§user",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"47.9",sektor:"G",sektorName:"Handel",zielgruppe:"Versand-/Internethandel",bewertung:"gruen",useCases:["voice-inbound","chatbot","support"],validiert:true},
            // H - Verkehr und Lagerei
            {code:"49.3",sektor:"H",sektorName:"Verkehr/Lagerei",zielgruppe:"Personenbef√∂rderung",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"49.4",sektor:"H",sektorName:"Verkehr/Lagerei",zielgruppe:"G√ºterbef√∂rderung Stra√üe",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"52.1",sektor:"H",sektorName:"Verkehr/Lagerei",zielgruppe:"Lagerei",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"53.2",sektor:"H",sektorName:"Verkehr/Lagerei",zielgruppe:"Kurierdienste",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            // I - Gastgewerbe
            {code:"55.1",sektor:"I",sektorName:"Gastgewerbe",zielgruppe:"Hotels",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"55.2",sektor:"I",sektorName:"Gastgewerbe",zielgruppe:"Ferienwohnungen",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"56.1",sektor:"I",sektorName:"Gastgewerbe",zielgruppe:"Restaurants",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"56.2",sektor:"I",sektorName:"Gastgewerbe",zielgruppe:"Caterer",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            // J - Information und Kommunikation
            {code:"58.1",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"Verlage",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"61.1",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"Telekommunikation",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"62.01",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"Softwareentwicklung",bewertung:"gruen",useCases:["chatbot","support"],validiert:true},
            {code:"62.02",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"IT-Beratung/Systemh√§user",bewertung:"gruen",useCases:["voice-inbound","chatbot","support"],validiert:true},
            {code:"62.03",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"IT-Betrieb/Hosting",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"62.09",sektor:"J",sektorName:"IT/Kommunikation",zielgruppe:"IT-Support/Helpdesk",bewertung:"gruen",useCases:["voice-inbound","chatbot","support"],validiert:true},
            // K - Finanz-/Versicherungs-DL
            {code:"64.1",sektor:"K",sektorName:"Finanzen",zielgruppe:"Banken/Sparkassen",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"64.92",sektor:"K",sektorName:"Finanzen",zielgruppe:"Kredite/Baufinanzierung",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"64.9",sektor:"K",sektorName:"Finanzen",zielgruppe:"Finanzberater/Verm√∂gensverwalter",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"65.1",sektor:"K",sektorName:"Finanzen",zielgruppe:"Versicherungsgesellschaften",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"66.19",sektor:"K",sektorName:"Finanzen",zielgruppe:"Finanzberatung",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"66.22",sektor:"K",sektorName:"Finanzen",zielgruppe:"Versicherungsmakler",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"66.29",sektor:"K",sektorName:"Finanzen",zielgruppe:"Versicherungsvertreter",bewertung:"gruen",useCases:["voice-outbound"],validiert:false},
            // L - Immobilien
            {code:"68.1",sektor:"L",sektorName:"Immobilien",zielgruppe:"Kauf/Verkauf Immobilien",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"68.2",sektor:"L",sektorName:"Immobilien",zielgruppe:"Vermietung/Verpachtung",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"68.3",sektor:"L",sektorName:"Immobilien",zielgruppe:"Hausverwaltung",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            // M - Freiberufliche DL
            {code:"69.1",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Rechtsberatung/Anw√§lte",bewertung:"gelb",useCases:["voice-inbound"],validiert:true},
            {code:"69.2",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Steuerberatung",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"70.2",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Unternehmensberatung",bewertung:"gruen",useCases:[],validiert:true},
            {code:"71.1",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Architekturb√ºros",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"71.2",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Ingenieurb√ºros",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"73.1",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Werbeagenturen",bewertung:"gelb",useCases:[],validiert:true},
            {code:"75.0",sektor:"M",sektorName:"Freiberufler",zielgruppe:"Tierarztpraxen",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            // N - Sonstige wirtschaftl. DL
            {code:"78.1",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Arbeitsvermittlung/Personalvermittler",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"78.2",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Zeitarbeit",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"79.1",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Reiseb√ºros",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"80.1",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Wach-/Sicherheitsdienste",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"81.1",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Hausmeisterdienste",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"81.2",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Geb√§udereinigung",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"81.3",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Garten-/Landschaftsbau",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"82.2",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Callcenter",bewertung:"gruen",useCases:["voice-inbound","voice-outbound","support"],validiert:true},
            {code:"82.91",sektor:"N",sektorName:"Wirtschaftl. DL",zielgruppe:"Inkasso/Factoring",bewertung:"gelb",useCases:["voice-outbound","support"],validiert:false},
            // O - √ñffentliche Verwaltung
            {code:"84.1",sektor:"O",sektorName:"√ñffentl. Verwaltung",zielgruppe:"Beh√∂rden/Kommunen",bewertung:"rot",useCases:["support"],validiert:false},
            // P - Erziehung und Unterricht
            {code:"85.1",sektor:"P",sektorName:"Bildung",zielgruppe:"Schulen (staatlich)",bewertung:"rot",useCases:[],validiert:false},
            {code:"85.3",sektor:"P",sektorName:"Bildung",zielgruppe:"Berufsbildung/Akademien",bewertung:"gruen",useCases:["voice-inbound","angebot"],validiert:true},
            {code:"85.5",sektor:"P",sektorName:"Bildung",zielgruppe:"Fahrschulen/Coaching/Nachhilfe",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            // Q - Gesundheits-/Sozialwesen
            {code:"86.10.1",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Akutkrankenh√§user",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"86.10.2",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Hochschulkliniken",bewertung:"rot",useCases:[],validiert:false},
            {code:"86.10.3",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Reha-Kliniken",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"86.10.4",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Privatkliniken",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:false},
            {code:"86.21",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Arztpraxen Allgemeinmedizin",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            {code:"86.22",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Facharztpraxen (allgemein)",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            {code:"86.22.01",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Orthop√§die/Unfallchirurgie",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.02",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Kardiologie",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.03",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Dermatologie",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.04",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Radiologie/Nuklearmedizin",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.05",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Gyn√§kologie",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            {code:"86.22.06",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Urologie",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.07",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"HNO (Hals-Nasen-Ohren)",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.08",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Augenheilkunde",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.09",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Neurologie",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.10",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Psychiatrie/Psychotherapie",bewertung:"gelb",useCases:[],validiert:false},
            {code:"86.22.11",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Gastroenterologie",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.13",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Onkologie/H√§matologie",bewertung:"gelb",useCases:[],validiert:false},
            {code:"86.22.17",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Chirurgie (ambulant)",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.21",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Sportmedizin",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.22.22",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Kinder-/Jugendmedizin",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.23",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Zahnarztpraxen",bewertung:"gruen",useCases:["voice-inbound"],validiert:false},
            {code:"86.90.11",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Psychologische Psychotherapeuten",bewertung:"gelb",useCases:[],validiert:false},
            {code:"86.90.21",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Physiotherapie",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            {code:"86.90.22",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Ergotherapie",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"86.90.23",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Logop√§die",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"86.90.24",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Osteopathie",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"86.90.91",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Medizinische Labore (allgemein)",bewertung:"gruen",useCases:["voice-outbound","support"],validiert:true},
            {code:"86.90.92",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Blutanalyselabore",bewertung:"gruen",useCases:["voice-outbound","support"],validiert:false},
            {code:"86.90.93",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Mikrobiologie-Labore",bewertung:"gruen",useCases:["voice-outbound","support"],validiert:false},
            {code:"86.90.94",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Pathologie-Labore",bewertung:"gelb",useCases:[],validiert:false},
            {code:"86.90.95",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Humangenetik-Labore",bewertung:"gelb",useCases:["voice-inbound"],validiert:true},
            {code:"86.90",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Optiker/H√∂rakustiker",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"86.90",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Heilpraktiker",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"87.1",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Pflegeheime",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"87.3",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Altenheime/Seniorenresidenzen",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"88.1",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Ambulante Pflegedienste",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"88.10.2",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"24h-Pflege-Vermittlung",bewertung:"gruen",useCases:["voice-inbound"],validiert:true},
            {code:"88.91.1",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Kinderkrippen (0-3 Jahre)",bewertung:"gruen",useCases:["voice-inbound","support"],validiert:true},
            {code:"88.91.2",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Kinderg√§rten (3-6 Jahre)",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"88.9",sektor:"Q",sektorName:"Gesundheit",zielgruppe:"Jugendhilfe",bewertung:"gelb",useCases:["voice-inbound"],validiert:true},
            // R - Kunst/Unterhaltung/Erholung
            {code:"93.1",sektor:"R",sektorName:"Sport/Freizeit",zielgruppe:"Fitnessstudios",bewertung:"gruen",useCases:["voice-outbound"],validiert:true},
            {code:"93.2",sektor:"R",sektorName:"Sport/Freizeit",zielgruppe:"Freizeitparks/B√§der",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            // S - Sonstige Dienstleistungen
            {code:"95.1",sektor:"S",sektorName:"Sonstige DL",zielgruppe:"Reparatur IT-Ger√§te",bewertung:"gelb",useCases:["voice-inbound","support"],validiert:false},
            {code:"95.2",sektor:"S",sektorName:"Sonstige DL",zielgruppe:"Reparatur Haushaltsger√§te",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"96.02",sektor:"S",sektorName:"Sonstige DL",zielgruppe:"Friseure/Kosmetik",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"96.03",sektor:"S",sektorName:"Sonstige DL",zielgruppe:"Bestattungsinstitute",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            {code:"96.04",sektor:"S",sektorName:"Sonstige DL",zielgruppe:"Wellness/Sauna",bewertung:"gelb",useCases:["voice-inbound"],validiert:false},
            // X - Spezial (nicht NACE-klassifiziert)
            {code:"N/A",sektor:"X",sektorName:"Spezial",zielgruppe:"Arbeitsschutz/Arbeitsmedizin",bewertung:"gruen",useCases:["voice-outbound","angebot"],validiert:true},
            {code:"N/A",sektor:"X",sektorName:"Spezial",zielgruppe:"Plakatwerbung/Au√üenwerbung",bewertung:"gelb",useCases:["chatbot","angebot"],validiert:true},
            {code:"N/A",sektor:"X",sektorName:"Spezial",zielgruppe:"Business-Netzwerke/BNI-√§hnlich",bewertung:"gelb",useCases:["voice-outbound"],validiert:true},
        ];

        // ===== FILTER STATE =====
        let activeRatingFilter = 'all';
        let activeSektorFilter = 'all';
        let validatedFilter = false;
        let activeUseCaseFilter = null;
        let searchTerm = '';

        function getBewertungBadge(bewertung) {
            const map = {
                'gruen': '<span class="badge badge-green">TOP</span>',
                'gelb': '<span class="badge badge-yellow">POTENZIAL</span>',
                'rot': '<span class="badge badge-red">NIEDRIG</span>'
            };
            return map[bewertung] || bewertung;
        }

        function getUseCaseTags(useCases) {
            if (!useCases || useCases.length === 0) return '<span class="empty-cell">‚Äî</span>';
            return '<div class="use-cases-cell">' + useCases.map(uc => {
                const label = USE_CASES[uc] || uc;
                return `<span class="use-case-tag uc-${uc}">${label}</span>`;
            }).join('') + '</div>';
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');

            let displayData = data.filter(item => {
                if (activeRatingFilter !== 'all') {
                    const filterMap = {'green':'gruen','yellow':'gelb','red':'rot'};
                    if (item.bewertung !== filterMap[activeRatingFilter]) return false;
                }
                if (activeSektorFilter !== 'all' && item.sektor !== activeSektorFilter) return false;
                if (validatedFilter && !item.validiert) return false;
                if (activeUseCaseFilter && !item.useCases.includes(activeUseCaseFilter)) return false;
                if (searchTerm && !item.zielgruppe.toLowerCase().includes(searchTerm.toLowerCase()) &&
                    !item.sektorName.toLowerCase().includes(searchTerm.toLowerCase())) return false;
                return true;
            });

            displayData.sort((a, b) => {
                const order = {'gruen': 0, 'gelb': 1, 'rot': 2};
                return order[a.bewertung] - order[b.bewertung];
            });

            tbody.innerHTML = displayData.map((item, index) => {
                const keywords = keywordsData[item.zielgruppe] || [];
                const rowId = `row-${index}`;
                const keywordsHtml = keywords.length > 0
                    ? keywords.map(kw => `<span class="keyword-tag" onclick="copyKeyword(this, '${kw.replace(/'/g, "\\'")}', event)">${kw}</span>`).join('')
                    : '<span class="no-keywords">Keine Keywords verf√ºgbar</span>';

                return `
                <tr data-code="${rowId}" onclick="toggleRow('${rowId}')">
                    <td>
                        <span class="expand-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </span>
                        ${getBewertungBadge(item.bewertung)}
                    </td>
                    <td><div class="sektor-cell"><span class="sektor-badge">${item.sektor}</span><span class="sektor-name">${item.sektorName}</span></div></td>
                    <td><span class="zielgruppe-name">${item.zielgruppe}</span></td>
                    <td>${getUseCaseTags(item.useCases)}</td>
                    <td>${item.validiert ? '<span class="validated-badge">Validiert</span>' : '<span class="empty-cell">‚Äî</span>'}</td>
                </tr>
                <tr class="keywords-row" data-keywords-for="${rowId}">
                    <td colspan="5">
                        <div class="keywords-content">
                            <div class="details-grid">
                                <div class="details-section">
                                    <div class="keywords-label">Alternative Bezeichnungen / Suchbegriffe</div>
                                    <div class="keywords-grid">${keywordsHtml}</div>
                                </div>
                                <div class="details-section details-meta">
                                    ${item.marktgroesse ? `<div class="meta-item"><span class="meta-label">Marktgr√∂√üe DE</span><span class="meta-value">${item.marktgroesse}</span></div>` : ''}
                                    ${item.telefonvolumen ? `<div class="meta-item"><span class="meta-label">Telefonvolumen</span><span class="meta-value">${item.telefonvolumen}</span></div>` : ''}
                                    ${item.technischeReife ? `<div class="meta-item"><span class="meta-label">Techn. Reife</span><span class="meta-value">${item.technischeReife}</span></div>` : ''}
                                    ${item.regulatorisch ? `<div class="meta-item"><span class="meta-label">Regulatorik</span><span class="meta-value">${item.regulatorisch}</span></div>` : ''}
                                </div>
                            </div>
                            ${item.notizen ? `<div class="details-notes"><span class="meta-label">Notizen:</span> ${item.notizen}</div>` : ''}
                        </div>
                    </td>
                </tr>
            `}).join('');

            // Update counts
            document.getElementById('totalCount').textContent = data.length;
            document.getElementById('greenCount').textContent = data.filter(d => d.bewertung === 'gruen').length;
            document.getElementById('yellowCount').textContent = data.filter(d => d.bewertung === 'gelb').length;
            document.getElementById('redCount').textContent = data.filter(d => d.bewertung === 'rot').length;
            document.getElementById('validatedCount').textContent = data.filter(d => d.validiert).length;

            document.getElementById('allRatingCount').textContent = data.length;
            document.getElementById('greenFilterCount').textContent = data.filter(d => d.bewertung === 'gruen').length;
            document.getElementById('yellowFilterCount').textContent = data.filter(d => d.bewertung === 'gelb').length;
            document.getElementById('redFilterCount').textContent = data.filter(d => d.bewertung === 'rot').length;
            document.getElementById('valFilterCount').textContent = data.filter(d => d.validiert).length;
        }

        function renderSektorFilters() {
            const container = document.getElementById('sektorFilters');
            const sektors = [...new Set(data.map(d => d.sektor))].sort();

            container.innerHTML = `
                <button class="filter-btn active" data-filter="all" data-type="sektor">Alle <span class="count">${data.length}</span></button>
                ${sektors.map(s => {
                    const count = data.filter(d => d.sektor === s).length;
                    const name = data.find(d => d.sektor === s)?.sektorName || s;
                    return `<button class="filter-btn" data-filter="${s}" data-type="sektor">${s} ‚Äì ${name} <span class="count">${count}</span></button>`;
                }).join('')}
            `;
        }

        // Event Listeners
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                const type = e.target.dataset.type;
                const filter = e.target.dataset.filter;

                if (type === 'rating') {
                    document.querySelectorAll('[data-type="rating"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    activeRatingFilter = filter;
                } else if (type === 'sektor') {
                    document.querySelectorAll('[data-type="sektor"]').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    activeSektorFilter = filter;
                } else if (type === 'validated') {
                    e.target.classList.toggle('active');
                    validatedFilter = e.target.classList.contains('active');
                }
                renderTable();
            }

            if (e.target.classList.contains('legend-item')) {
                const uc = e.target.dataset.uc;
                document.querySelectorAll('.legend-item').forEach(el => el.classList.remove('active'));
                if (activeUseCaseFilter === uc) {
                    activeUseCaseFilter = null;
                } else {
                    e.target.classList.add('active');
                    activeUseCaseFilter = uc;
                }
                renderTable();
            }
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderTable();
        });

        // Initial render - Async laden
        init();
    </script>
</body>
</html>
